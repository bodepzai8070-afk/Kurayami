<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kurayami Thơ Tình 💞</title>
<style>
  body {
    font-family: "Georgia", serif;
    background: radial-gradient(circle at top, #ffd1dc, #b8c6db);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 1s, color 1s;
    overflow-x: hidden;
  }
  .container {
    background: rgba(255,255,255,0.9);
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.2);
    width: 90%;
    max-width: 550px;
  }
  h2 { text-align: center; color: #d63384; }
  input, textarea, button {
    width: 100%; padding: 10px; margin-top: 8px;
    border-radius: 10px; border: 1px solid #ccc;
    font-size: 16px;
  }
  textarea { height: 150px; resize: none; }
  button {
    background: #ff4d6d; color: white; border: none;
    font-weight: bold; cursor: pointer; transition: 0.3s;
  }
  button:hover { background: #d63384; }
  .poem-box {
    background: #fff5f7; padding: 15px; border-radius: 10px; margin-top: 20px;
  }
  .kurayami { text-align: center; font-size: 12px; margin-top: 10px; color: #555; }
  .advice { margin-top: 10px; font-style: italic; color: #333; background: #f8f1ff; padding: 8px; border-radius: 8px; }
  .heart {
    position: fixed; bottom: 0; color: red; opacity: 0.8;
    animation: floatUp 5s linear infinite;
  }
  @keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-100vh) scale(0.5); opacity: 0; }
  }
</style>
</head>
<body>

<div class="container">
  <h2>💌 Kurayami Thơ Gửi Người Thương 💌</h2>

  <div id="nameSection">
    <label>Người viết:</label>
    <input type="text" id="authorName" placeholder="Tên bạn...">
    <label>Gửi đến:</label>
    <input type="text" id="receiverName" placeholder="Tên người bạn yêu...">
    <button onclick="startWriting()">Bắt đầu viết thơ</button>
  </div>

  <div id="poemSection" style="display:none;">
    <label>Viết bài thơ của bạn:</label>
    <textarea id="poemText" placeholder="Hãy viết những cảm xúc thật lòng..."></textarea>
    <button onclick="savePoem()">Lưu bài thơ 💖</button>
  </div>

  <div id="savedPoems"></div>

  <div class="kurayami">🌙 Được tạo bởi <b>Kurayami</b> – Ngày <span id="today"></span></div>
</div>

<audio autoplay loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_06ef763ea2.mp3?filename=romantic-piano-112199.mp3" type="audio/mpeg">
</audio>

<script>
document.getElementById("today").textContent = new Date().toLocaleDateString('vi-VN');

const badWords = ["đm","dm","mẹ","ngu","chó","cmm","cc","vcl","dcm","lồn","địt","loz","đjt","cặc","fuck","shit"];
const sarcasmWords = ["đồ ngốc","đáng ghét","khùng","đồ dở hơi","đồ đáng yêu ghê"];

function filterBadWords(text) {
  let clean = text;
  let foundBad = false;
  badWords.forEach(w => {
    const regex = new RegExp(w, "gi");
    if (regex.test(clean)) foundBad = true;
    clean = clean.replace(regex, "💫");
  });
  if (foundBad) alert("⚠️ Kurayami đã xoá ngôn từ không phù hợp để giữ thơ trong sáng!");
  return clean;
}

function detectSarcasm(text) {
  return sarcasmWords.some(w => new RegExp(w, "gi").test(text));
}

function startWriting() {
  const a = document.getElementById("authorName").value.trim();
  const r = document.getElementById("receiverName").value.trim();
  if (!a || !r) return alert("Vui lòng nhập đầy đủ tên!");
  localStorage.setItem("author", a);
  localStorage.setItem("receiver", r);
  document.getElementById("nameSection").style.display = "none";
  document.getElementById("poemSection").style.display = "block";
  loadPoems();
}

function savePoem() {
  let text = document.getElementById("poemText").value.trim();
  if (!text) return alert("Bài thơ không được để trống!");
  text = filterBadWords(text);
  const sarcastic = detectSarcasm(text);
  if (sarcastic) alert("😏 Kurayami phát hiện châm biếm, nhưng vẫn giữ lại vì thơ cũng cần chút hóm hỉnh!");
  const poems = JSON.parse(localStorage.getItem("poems") || "[]");
  poems.push({ 
    author: localStorage.getItem("author"),
    receiver: localStorage.getItem("receiver"),
    poem: text,
    date: new Date().toLocaleString('vi-VN'),
    score: null
  });
  localStorage.setItem("poems", JSON.stringify(poems));
  document.getElementById("poemText").value = "";
  loadPoems();
}

function loadPoems() {
  const poems = JSON.parse(localStorage.getItem("poems") || "[]");
  const box = document.getElementById("savedPoems");
  box.innerHTML = "<h3>🌸 Những Bài Thơ Đã Viết 🌸</h3>";
  poems.forEach((p, i) => {
    const advice = p.score !== null ? getAdvice(p.score) : "";
    box.innerHTML += `
      <div class="poem-box">
        <b>${p.author}</b> gửi đến <b>${p.receiver}</b>:<br>
        <p>${p.poem.replace(/\n/g, "<br>")}</p>
        <div class="date">📅 ${p.date}</div>
        <label>Chấm điểm (0-10):</label>
        <input type="number" id="score${i}" min="0" max="10" value="${p.score ?? ""}">
        <button onclick="ratePoem(${i})">Lưu điểm</button>
        ${advice}
      </div>`;
  });
}

function ratePoem(i) {
  const poems = JSON.parse(localStorage.getItem("poems") || "[]");
  const val = parseFloat(document.getElementById(`score${i}`).value);
  if (isNaN(val) || val < 0 || val > 10) return alert("Điểm từ 0–10 nhé!");
  poems[i].score = val;
  localStorage.setItem("poems", JSON.stringify(poems));
  alert("💖 Kurayami đã ghi nhận cảm xúc của bạn!");
  loadPoems();
}

function getAdvice(score) {
  if (score < 5) return `<div class="advice">😔 Kurayami: Cậu viết chưa đạt, nhưng đừng buồn nhé! Ai cũng có lúc thất bại, thử lại nào 💪</div>`;
  if (score < 7) return `<div class="advice">😊 Kurayami: Ôi, thơ cậu hay quá nè! Chắc người ấy đọc sẽ cười hạnh phúc đó 😍</div>`;
  return `<div class="advice">💖 Kurayami: Xuất sắc luôn! Cậu và người ấy chắc chắn sẽ bền lâu và ngọt ngào mãi mãi 💞</div>`;
}

// Trái tim bay
setInterval(() => {
  const h = document.createElement("div");
  h.className = "heart";
  h.innerHTML = "❤️";
  h.style.left = Math.random() * 100 + "vw";
  h.style.fontSize = (Math.random() * 20 + 10) + "px";
  h.style.animationDuration = (Math.random() * 3 + 2) + "s";
  document.body.appendChild(h);
  setTimeout(() => h.remove(), 5000);
}, 500);
</script>
</body>
</html>
