<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kurayami ThÆ¡ TÃ¬nh ğŸ’</title>
<style>
  body {
    font-family: "Georgia", serif;
    background: radial-gradient(circle at top, #ffd1dc, #b8c6db);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 1s, color 1s;
    overflow-x: hidden;
  }
  .container {
    background: rgba(255,255,255,0.9);
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.2);
    width: 90%;
    max-width: 550px;
  }
  h2 { text-align: center; color: #d63384; }
  input, textarea, button {
    width: 100%; padding: 10px; margin-top: 8px;
    border-radius: 10px; border: 1px solid #ccc;
    font-size: 16px;
  }
  textarea { height: 150px; resize: none; }
  button {
    background: #ff4d6d; color: white; border: none;
    font-weight: bold; cursor: pointer; transition: 0.3s;
  }
  button:hover { background: #d63384; }
  .poem-box {
    background: #fff5f7; padding: 15px; border-radius: 10px; margin-top: 20px;
  }
  .kurayami { text-align: center; font-size: 12px; margin-top: 10px; color: #555; }
  .advice { margin-top: 10px; font-style: italic; color: #333; background: #f8f1ff; padding: 8px; border-radius: 8px; }
  .heart {
    position: fixed; bottom: 0; color: red; opacity: 0.8;
    animation: floatUp 5s linear infinite;
  }
  @keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-100vh) scale(0.5); opacity: 0; }
  }
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ’Œ Kurayami ThÆ¡ Gá»­i NgÆ°á»i ThÆ°Æ¡ng ğŸ’Œ</h2>

  <div id="nameSection">
    <label>NgÆ°á»i viáº¿t:</label>
    <input type="text" id="authorName" placeholder="TÃªn báº¡n...">
    <label>Gá»­i Ä‘áº¿n:</label>
    <input type="text" id="receiverName" placeholder="TÃªn ngÆ°á»i báº¡n yÃªu...">
    <button onclick="startWriting()">Báº¯t Ä‘áº§u viáº¿t thÆ¡</button>
  </div>

  <div id="poemSection" style="display:none;">
    <label>Viáº¿t bÃ i thÆ¡ cá»§a báº¡n:</label>
    <textarea id="poemText" placeholder="HÃ£y viáº¿t nhá»¯ng cáº£m xÃºc tháº­t lÃ²ng..."></textarea>
    <button onclick="savePoem()">LÆ°u bÃ i thÆ¡ ğŸ’–</button>
  </div>

  <div id="savedPoems"></div>

  <div class="kurayami">ğŸŒ™ ÄÆ°á»£c táº¡o bá»Ÿi <b>Kurayami</b> â€“ NgÃ y <span id="today"></span></div>
</div>

<audio autoplay loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_06ef763ea2.mp3?filename=romantic-piano-112199.mp3" type="audio/mpeg">
</audio>

<script>
document.getElementById("today").textContent = new Date().toLocaleDateString('vi-VN');

const badWords = ["Ä‘m","dm","máº¹","ngu","chÃ³","cmm","cc","vcl","dcm","lá»“n","Ä‘á»‹t","loz","Ä‘jt","cáº·c","fuck","shit"];
const sarcasmWords = ["Ä‘á»“ ngá»‘c","Ä‘Ã¡ng ghÃ©t","khÃ¹ng","Ä‘á»“ dá»Ÿ hÆ¡i","Ä‘á»“ Ä‘Ã¡ng yÃªu ghÃª"];

function filterBadWords(text) {
  let clean = text;
  let foundBad = false;
  badWords.forEach(w => {
    const regex = new RegExp(w, "gi");
    if (regex.test(clean)) foundBad = true;
    clean = clean.replace(regex, "ğŸ’«");
  });
  if (foundBad) alert("âš ï¸ Kurayami Ä‘Ã£ xoÃ¡ ngÃ´n tá»« khÃ´ng phÃ¹ há»£p Ä‘á»ƒ giá»¯ thÆ¡ trong sÃ¡ng!");
  return clean;
}

function detectSarcasm(text) {
  return sarcasmWords.some(w => new RegExp(w, "gi").test(text));
}

function startWriting() {
  const a = document.getElementById("authorName").value.trim();
  const r = document.getElementById("receiverName").value.trim();
  if (!a || !r) return alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ tÃªn!");
  localStorage.setItem("author", a);
  localStorage.setItem("receiver", r);
  document.getElementById("nameSection").style.display = "none";
  document.getElementById("poemSection").style.display = "block";
  loadPoems();
}

function savePoem() {
  let text = document.getElementById("poemText").value.trim();
  if (!text) return alert("BÃ i thÆ¡ khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng!");
  text = filterBadWords(text);
  const sarcastic = detectSarcasm(text);
  if (sarcastic) alert("ğŸ˜ Kurayami phÃ¡t hiá»‡n chÃ¢m biáº¿m, nhÆ°ng váº«n giá»¯ láº¡i vÃ¬ thÆ¡ cÅ©ng cáº§n chÃºt hÃ³m há»‰nh!");
  const poems = JSON.parse(localStorage.getItem("poems") || "[]");
  poems.push({ 
    author: localStorage.getItem("author"),
    receiver: localStorage.getItem("receiver"),
    poem: text,
    date: new Date().toLocaleString('vi-VN'),
    score: null
  });
  localStorage.setItem("poems", JSON.stringify(poems));
  document.getElementById("poemText").value = "";
  loadPoems();
}

function loadPoems() {
  const poems = JSON.parse(localStorage.getItem("poems") || "[]");
  const box = document.getElementById("savedPoems");
  box.innerHTML = "<h3>ğŸŒ¸ Nhá»¯ng BÃ i ThÆ¡ ÄÃ£ Viáº¿t ğŸŒ¸</h3>";
  poems.forEach((p, i) => {
    const advice = p.score !== null ? getAdvice(p.score) : "";
    box.innerHTML += `
      <div class="poem-box">
        <b>${p.author}</b> gá»­i Ä‘áº¿n <b>${p.receiver}</b>:<br>
        <p>${p.poem.replace(/\n/g, "<br>")}</p>
        <div class="date">ğŸ“… ${p.date}</div>
        <label>Cháº¥m Ä‘iá»ƒm (0-10):</label>
        <input type="number" id="score${i}" min="0" max="10" value="${p.score ?? ""}">
        <button onclick="ratePoem(${i})">LÆ°u Ä‘iá»ƒm</button>
        ${advice}
      </div>`;
  });
}

function ratePoem(i) {
  const poems = JSON.parse(localStorage.getItem("poems") || "[]");
  const val = parseFloat(document.getElementById(`score${i}`).value);
  if (isNaN(val) || val < 0 || val > 10) return alert("Äiá»ƒm tá»« 0â€“10 nhÃ©!");
  poems[i].score = val;
  localStorage.setItem("poems", JSON.stringify(poems));
  alert("ğŸ’– Kurayami Ä‘Ã£ ghi nháº­n cáº£m xÃºc cá»§a báº¡n!");
  loadPoems();
}

function getAdvice(score) {
  if (score < 5) return `<div class="advice">ğŸ˜” Kurayami: Cáº­u viáº¿t chÆ°a Ä‘áº¡t, nhÆ°ng Ä‘á»«ng buá»“n nhÃ©! Ai cÅ©ng cÃ³ lÃºc tháº¥t báº¡i, thá»­ láº¡i nÃ o ğŸ’ª</div>`;
  if (score < 7) return `<div class="advice">ğŸ˜Š Kurayami: Ã”i, thÆ¡ cáº­u hay quÃ¡ nÃ¨! Cháº¯c ngÆ°á»i áº¥y Ä‘á»c sáº½ cÆ°á»i háº¡nh phÃºc Ä‘Ã³ ğŸ˜</div>`;
  return `<div class="advice">ğŸ’– Kurayami: Xuáº¥t sáº¯c luÃ´n! Cáº­u vÃ  ngÆ°á»i áº¥y cháº¯c cháº¯n sáº½ bá»n lÃ¢u vÃ  ngá»t ngÃ o mÃ£i mÃ£i ğŸ’</div>`;
}

// TrÃ¡i tim bay
setInterval(() => {
  const h = document.createElement("div");
  h.className = "heart";
  h.innerHTML = "â¤ï¸";
  h.style.left = Math.random() * 100 + "vw";
  h.style.fontSize = (Math.random() * 20 + 10) + "px";
  h.style.animationDuration = (Math.random() * 3 + 2) + "s";
  document.body.appendChild(h);
  setTimeout(() => h.remove(), 5000);
}, 500);
</script>
</body>
</html>
