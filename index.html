<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vi·∫øt VƒÉn & Vi·∫øt S·ª≠ - Kurayami</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #fafafa;
      margin: 0;
      padding: 0;
    }
    header {
      background: #222;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.5em;
    }
    main {
      max-width: 800px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
    }
    button {
      background: #0078ff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 10px;
      font-size: 1em;
    }
    button:hover {
      background: #005fcc;
    }
    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    .post {
      background: #f7f7f7;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .post h3 {
      margin: 0 0 10px;
    }
    .btn-group {
      margin-top: 10px;
    }
    #banNotice {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 1.6em;
      text-align: center;
      z-index: 9999;
      display: none;
      padding: 20px;
    }
    #banNotice.show {
      display: flex;
    }
    #countdown {
      font-size: 2.5em;
      margin: 20px 0;
      color: #ff3333;
      font-weight: bold;
    }
    #deviceId {
      font-size: 0.8em;
      margin-top: 15px;
      color: #ccc;
    }
    #reloadNotice {
      background: #ff3333;
      color: white;
      padding: 12px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 20px;
      border-radius: 8px;
      font-size: 1.1em;
    }
    .warn-vnch {
      background: #fff3cd;
      color: #856404;
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>Vi·∫øt VƒÉn & Vi·∫øt S·ª≠ - Kurayami</header>
  
  <div id="reloadNotice">Web Kurayami ‚Äì T√¥i kh√¥ng n·∫±m ngo√†i ph√°p lu·∫≠t. Ai qu√©t m·∫°nh tay! C·∫•m vƒ©nh vi·ªÖn n·∫øu x√∫c ph·∫°m.</div>

  <main>
    <div id="status" class="warn-vnch" style="display:none;"></div>

    <h2>T·∫°o b√†i vi·∫øt m·ªõi</h2>
    <input id="title" type="text" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b√†i vi·∫øt..." />
    <textarea id="content" rows="8" placeholder="Nh·∫≠p n·ªôi dung b√†i vi·∫øt..."></textarea>
    <button id="saveBtn" onclick="savePost()">L∆∞u b√†i</button>
    <button onclick="clearAll()">X√≥a t·∫•t c·∫£</button>

    <hr>

    <h2>Danh s√°ch b√†i vi·∫øt</h2>
    <div id="posts"></div>
  </main>

  <!-- Ban overlay -->
  <div id="banNotice">
    <p id="banTitle">B·∫†N ƒê√É B·ªä C·∫§M!</p>
    <p id="banReason"></p>
    <div id="countdown"></div>
    <p id="deviceId"></p>
    <p style="font-size:0.9em; margin-top:20px;">Kh√¥ng th·ªÉ bypass. Kh√¥ng fake VPN. Kh√¥ng x√≥a localStorage. Theo ƒë·ªãa ch·ªâ m√°y.</p>
  </div>

  <script>
    const postsDiv = document.getElementById('posts');
    const banNotice = document.getElementById('banNotice');
    const banTitle = document.getElementById('banTitle');
    const banReasonEl = document.getElementById('banReason');
    const countdownEl = document.getElementById('countdown');
    const deviceIdEl = document.getElementById('deviceId');
    const saveBtn = document.getElementById('saveBtn');
    const statusDiv = document.getElementById('status');

    // === T·∫†O ƒê·ªäA CH·ªà M√ÅY (Device Fingerprint) ===
    let deviceId = localStorage.getItem('kurayami_device_id');
    if (!deviceId) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.textBaseline = 'top';
      ctx.font = '14px Arial';
      ctx.fillText('Kurayami Device ID', 2, 2);
      const data = canvas.toDataURL();
      deviceId = btoa(data + navigator.userAgent + screen.width + screen.height).substring(0, 32);
      localStorage.setItem('kurayami_device_id', deviceId);
    }
    deviceIdEl.textContent = `M√°y: ${deviceId}`;

    // === DANH S√ÅCH T·ª™ KH√ìA ===
    const bannedKeywords = {
      vnch: ['vnch', 'vi·ªát nam c·ªông h√≤a', 'ng·ª•y quy·ªÅn', 'ng·ª•y qu√¢n'],
      dcsvn: ['ƒëcs vn', 'ƒë·∫£ng c·ªông s·∫£n vi·ªát nam', 'ƒë·∫£ng csvn'],
      ho: ['b√°c h·ªì', 'h·ªì ch√≠ minh', 'b√°c h'],
      giap: ['b√°c gi√°p', 'v√µ nguy√™n gi√°p'],
      liet_si: /li·ªát\s*sƒ©|anh\s*h√πng.*(ch·ª≠i|x√∫c ph·∫°m|ƒë·ªì|k·∫ª)/i
    };

    const offensiveWords = {
      vnch: ['ng·ª•y', 'ph·∫£n ƒë·ªông', 'b√°n n∆∞·ªõc', 'tay sai'],
      ho: ['k·∫ª', 'ƒë·ªì', 'gi·∫£', 'd·ªëi', 'ph·∫£n', 't·ªôi ƒë·ªì'],
      giap: ['ph·∫£n', 'b·ªôi', 't·ªôi ƒë·ªì', 'k·∫ª']
    };

    // === L∆ØU TR·ªÆ C·∫§M THEO M√ÅY ===
    const banKey = `kurayami_ban_${deviceId}`;
    let banData = JSON.parse(localStorage.getItem(banKey) || 'null');

    // === KI·ªÇM TRA C·∫§M KHI LOAD ===
    function checkBan() {
      if (!banData) return;
      const now = Date.now();
      if (banData.permanent) {
        showPermanentBan();
      } else if (banData.until > now) {
        startCountdown(banData.until, banData.reason);
      } else {
        localStorage.removeItem(banKey);
        banData = null;
      }
    }

    function showPermanentBan() {
      banTitle.textContent = 'C·∫§M Vƒ®NH VI·ªÑN';
      banReasonEl.textContent = 'X√∫c ph·∫°m ƒêCS VN, B√°c H·ªì, B√°c Gi√°p ho·∫∑c anh h√πng li·ªát sƒ©.';
      banNotice.classList.add('show');
      disableAllInputs();
    }

    function startCountdown(until, reason) {
      banTitle.textContent = 'C·∫§M 24 GI·ªú';
      banReasonEl.textContent = reason;
      banNotice.classList.add('show');
      disableAllInputs();

      const interval = setInterval(() => {
        const remaining = Math.max(0, Math.floor((until - Date.now()) / 1000));
        if (remaining === 0) {
          clearInterval(interval);
          banNotice.classList.remove('show');
          localStorage.removeItem(banKey);
          banData = null;
          location.reload();
          return;
        }
        const h = String(Math.floor(remaining / 3600)).padStart(2, '0');
        const m = String(Math.floor((remaining % 3600) / 60)).padStart(2, '0');
        const s = String(remaining % 60).padStart(2, '0');
        countdownEl.textContent = `${h}:${m}:${s}`;
      }, 1000);
    }

    function disableAllInputs() {
      saveBtn.disabled = true;
      document.querySelectorAll('button, input, textarea').forEach(el => el.disabled = true);
    }

    // === PH√ÇN T√çCH N·ªòI DUNG ===
    function analyzePost(title, content) {
      const text = `${title} ${content}`.toLowerCase();
      let isVNCHMention = false;
      let isOffensive = false;
      const errors = [];

      // 1. Ch·ªâ nh·∫Øc VNCH (kh√¥ng x√∫c ph·∫°m)
      for (const kw of bannedKeywords.vnch) {
        if (text.includes(kw)) {
          isVNCHMention = true;
          // Ki·ªÉm tra c√≥ x√∫c ph·∫°m kh√¥ng
          for (const bad of offensiveWords.vnch) {
            if (text.includes(bad)) {
              isOffensive = true;
              errors.push(`X√∫c ph·∫°m VNCH v·ªõi t·ª´: "${bad}"`);
            }
          }
        }
      }

      // 2. X√∫c ph·∫°m c√°c ƒë·ªëi t∆∞·ª£ng kh√°c ‚Üí C·∫§M Vƒ®NH VI·ªÑN
      if (bannedKeywords.dcsvn.some(kw => text.includes(kw.toLowerCase()))) {
        isOffensive = true;
        errors.push('X√∫c ph·∫°m ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam');
      }
      if (bannedKeywords.ho.some(kw => text.includes(kw.toLowerCase()))) {
        for (const bad of offensiveWords.ho) {
          if (text.includes(bad)) {
            isOffensive = true;
            errors.push(`X√∫c ph·∫°m B√°c H·ªì v·ªõi t·ª´: "${bad}"`);
          }
        }
      }
      if (bannedKeywords.giap.some(kw => text.includes(kw.toLowerCase()))) {
        for (const bad of offensiveWords.giap) {
          if (text.includes(bad)) {
            isOffensive = true;
            errors.push(`X√∫c ph·∫°m ƒê·∫°i t∆∞·ªõng V√µ Nguy√™n Gi√°p v·ªõi t·ª´: "${bad}"`);
          }
        }
      }
      if (bannedKeywords.liet_si.test(text)) {
        isOffensive = true;
        errors.push('X√∫c ph·∫°m c√°c anh h√πng li·ªát sƒ©');
      }

      return { isVNCHMention, isOffensive, errors };
    }

    // === L∆ØU B√ÄI VI·∫æT ===
    function savePost() {
      const title = document.getElementById('title').value.trim();
      const content = document.getElementById('content').value.trim();
      if (!title || !content) {
        alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ti√™u ƒë·ªÅ v√† n·ªôi dung!');
        return;
      }

      const analysis = analyzePost(title, content);

      if (analysis.isOffensive) {
        // C·∫§M Vƒ®NH VI·ªÑN
        const reason = `VI PH·∫†M NGHI√äM TR·ªåNG: ${analysis.errors.join('; ')}`;
        localStorage.setItem(banKey, JSON.stringify({ permanent: true, reason }));
        showPermanentBan();
        return;
      }

      if (analysis.isVNCHMention) {
        // CH·ªà NH·∫ÆC VNCH ‚Üí C·∫§M 24H
        const reason = 'Ch·ªâ ƒë∆∞·ª£c nh·∫Øc VNCH 1 l·∫ßn. T√°i ph·∫°m: c·∫•m vƒ©nh vi·ªÖn.';
        const until = Date.now() + 24 * 60 * 60 * 1000;
        localStorage.setItem(banKey, JSON.stringify({ until, reason, permanent: false }));
        startCountdown(until, reason);
        statusDiv.textContent = 'C·∫£nh b√°o: ƒê√£ nh·∫Øc VNCH ‚Üí C·∫•m 24h. Kh√¥ng ƒë∆∞·ª£c nh·∫Øc l·∫°i!';
        statusDiv.style.display = 'block';
        return;
      }

      // H·ª¢P L·ªÜ ‚Üí L∆ØU
      const post = { id: Date.now(), title, content };
      const posts = JSON.parse(localStorage.getItem('kurayami_posts') || '[]');
      posts.push(post);
      localStorage.setItem('kurayami_posts', JSON.stringify(posts));
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      loadPosts();
      alert('B√†i vi·∫øt ƒë√£ l∆∞u th√†nh c√¥ng!');
    }

    // === HI·ªÇN TH·ªä DANH S√ÅCH ===
    function loadPosts() {
      postsDiv.innerHTML = '';
      const posts = JSON.parse(localStorage.getItem('kurayami_posts') || '[]');
      posts.reverse().forEach(post => {
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <h3>${post.title}</h3>
          <div class="btn-group">
            <button onclick="viewPost(${post.id})">Xem</button>
            <button onclick="deletePost(${post.id})">X√≥a</button>
          </div>
        `;
        postsDiv.appendChild(div);
      });
    }

    function viewPost(id) {
      const posts = JSON.parse(localStorage.getItem('kurayami_posts') || '[]');
      const post = posts.find(p => p.id === id);
      if (post) alert(`üìú ${post.title}\n\n${post.content}`);
    }

    function deletePost(id) {
      if (confirm('X√≥a b√†i n√†y?')) {
        let posts = JSON.parse(localStorage.getItem('kurayami_posts') || '[]');
        posts = posts.filter(p => p.id !== id);
        localStorage.setItem('kurayami_posts', JSON.stringify(posts));
        loadPosts();
      }
    }

    function clearAll() {
      if (confirm('X√≥a t·∫•t c·∫£ b√†i vi·∫øt?')) {
        localStorage.removeItem('kurayami_posts');
        loadPosts();
      }
    }

    // === KH·ªûI ƒê·ªòNG ===
    checkBan();
    loadPosts();

    // Th√¥ng b√°o reload
    window.addEventListener('load', () => {
      document.getElementById('reloadNotice').style.display = 'block';
    });
  </script>
</body>
</html>
